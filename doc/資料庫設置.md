### PostgreSQL

#### 安裝
於 archlinux 下可直接用 `pacman -S postgresql` 安裝。該指令同時會創建一個名為 postgres 的使用者，之後欲直接操作資料庫都需透過該使用者進行。

在 ubuntu 中，則可執行 `apt install postgresql` 安裝 postgres 資料庫，並執行 `apt install libpq-dev` 安裝 libpq ，往後編譯時才能鏈接到。


#### 初始化資料庫（在 ubuntu 下可能不需要）
轉換成 postgres 使用者後，用以下指令初始化資料庫（ubuntu 下可不用初始化，並且似乎會自動啓動）：

```sh
initdb -D /var/lib/postgres/data
```

#### 修改登入方式（在 ubuntu 下通常需要）
在 ubuntu 底下，postgres 通常預設以 unix socket 登入，於是若我們運行 `psql -U postgres` 往往會得到 `peer authentication fail` 的錯誤。我們可以編輯檔案 `/etc/postgresql/{some version}/main/pg_hba.conf`，將下面這行：
```
local   all             postgres                                peer
```
的 `peer` 改為 `md5`。

> 這一操作的意思是不再用 Unix socket 登入，而是透過外部 MD5 認證。

重新啟動 postgres，再次運行 `psql -U postgres`，應該就會叫你打密碼了。

#### 運行
安裝完成後運行 `sudo -iu postgres`。如果遭遇問題，用 visudo 加入下列指令：
```sh
# 將`carbonbond` 代換成你運行伺服器的使用者名字
carbonbond ALL=(postgres) NOPASSWD:/bin/bash
```

啓動
```
systemctl start postgresql.service
# 或者
pg_ctl -D /var/lib/postgres/data -l logfile start
# 如果遇到權限上的問題，可用 chown postgres:postgres dir_name 解決
# 如果 pg_ctl 無法開啟資料庫，可以試試：
systemctl restart postgresql
```

然後就可以開始使用 `psql`
```
psql -l # 可以看到目前資料庫中的狀況
```

#### 資料庫遷移

第一次使用，需執行

```
cargo run --bin prepare --features=prepare -- -m
```

schema 改變時，用以下指令遷移

```
cargo run --bin prepare --features=prepare -- -cm
```

### redis

#### 安裝

```
sudo apt install redis
```