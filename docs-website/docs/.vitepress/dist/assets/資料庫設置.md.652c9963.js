import{_ as s,c as a,o as e,a as l}from"./app.99d91e23.js";const g=JSON.parse('{"title":"資料庫設置","description":"","frontmatter":{},"headers":[{"level":3,"title":"PostgreSQL","slug":"postgresql","link":"#postgresql","children":[]},{"level":3,"title":"安裝","slug":"安裝","link":"#安裝","children":[]},{"level":3,"title":"設定","slug":"設定","link":"#設定","children":[]},{"level":3,"title":"資料庫遷移","slug":"資料庫遷移","link":"#資料庫遷移","children":[]},{"level":2,"title":"redis","slug":"redis","link":"#redis","children":[]}],"relativePath":"資料庫設置.md"}'),n={name:"資料庫設置.md"},p=l(`<h1 id="資料庫設置" tabindex="-1">資料庫設置 <a class="header-anchor" href="#資料庫設置" aria-hidden="true">#</a></h1><h3 id="postgresql" tabindex="-1">PostgreSQL <a class="header-anchor" href="#postgresql" aria-hidden="true">#</a></h3><h3 id="安裝" tabindex="-1">安裝 <a class="header-anchor" href="#安裝" aria-hidden="true">#</a></h3><p>執行 <code>apt install postgresql</code> 安裝 postgres 資料庫，並執行 <code>apt install libpq-dev</code> 安裝 libpq ，往後編譯時才能鏈接到。</p><h3 id="設定" tabindex="-1">設定 <a class="header-anchor" href="#設定" aria-hidden="true">#</a></h3><ol><li>設定 postgres 用戶的密碼</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-iu</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">postgres</span><span style="color:#A6ACCD;">                             </span><span style="color:#676E95;font-style:italic;"># 轉換成 postgres 使用者。</span></span>
<span class="line"><span style="color:#FFCB6B;">psql</span><span style="color:#A6ACCD;">                                          </span><span style="color:#676E95;font-style:italic;"># 進入 postgresql 的客戶端</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ALTER USER postgres PASSWORD </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mypassword</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 設定 postgres 用戶的密碼</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li><p>修改 carbonbond.toml 或 carbonbond.dev.toml [database] 的 password 欄位</p></li><li><p>將 postgres 用戶的登入方式改為使用密碼</p></li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vim</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">/etc/postgresql/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">postgresql版本</span><span style="color:#A6ACCD;">號</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">/main/pg_hba.conf</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 將</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># local all postgres peer</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 改為</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># local all postgres md5 </span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>啟動/重啟 postgresql</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">postgresql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"></span></code></pre></div><h3 id="資料庫遷移" tabindex="-1">資料庫遷移 <a class="header-anchor" href="#資料庫遷移" aria-hidden="true">#</a></h3><p>第一次使用，執行以下指令以創建資料庫及表格</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">cargo run --bin prepare --features=prepare -- -m</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>後續遷移資料庫時可執行</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">cargo run --bin prepare --features=prepare -- -cm</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="redis" tabindex="-1">redis <a class="header-anchor" href="#redis" aria-hidden="true">#</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">sudo apt install redis</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo service redis-server start</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div>`,18),t=[p];function o(r,c,i,d,h,y){return e(),a("div",null,t)}const u=s(n,[["render",o]]);export{g as __pageData,u as default};
